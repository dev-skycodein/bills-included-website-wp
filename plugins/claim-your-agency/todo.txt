Claim my Agency

[] when claim is approved the agent is assigned to agency package but due to no subscription created the payment status is pending. So he is reverted to basic role. only one listing to which he claimed for is assigned. (implemented but need to verify)

[] Agency logo is a purple house for now, and value is setting and fetching from single source truth. Can be edited by the Agent claimed that agnecy. the new image will also save on the same single source key. (implemented but need to verify)

[] Thanks message on success popup after claim for the agencyis submitted. (implemented but need to verify)

[] Data analytics storage. 



Claim My Agency – implementation steps (high level)
[✓] 1. Start Verification (front-end)
   - Add “Claim this agency” button on single listing pages (only for unclaimed agencies) that opens a popup form.
   - Popup collects: name, work email, pre-filled agency name, agency website, and optional validation info (staff page URL, Companies House URL, notes, consent).
   - On submit, create a pending claim record (CPT/table) tied to the agency (and listing), with status = pending.

[✓] 2. Email-based domain verification (Firebase – no access before approval)
   - Use Firebase Auth Email Link (passwordless) to verify ownership of the work email used in the claim.
   - Do NOT grant WordPress/agency access yet; treat the verified email as an identity only, until an admin approves the claim.

[✓] 3. Manual review in admin
   - Build an admin screen listing all pending claims with the submitted data and a domain match hint (email domain vs agency website).
   - Admin manually clicks Approve or Reject for each claim; no automatic approval.

[✓] 4. On approval: link user, role and agency
   - After approval, create or locate the corresponding WordPress user for the verified email.
   - Assign them the Agency package role (e.g. role from package ID 5402) and store them as the owner of the agency profile (agency_owner).
   - Optionally reassign all listings for that agency so the new owner becomes the post author.

[✓] 5. Post-approval access and dashboard
   - Configure Firebase Email Link so approved owners can log in via their work email.
   - After login, redirect them to /agency-admin (or /my-account) where they see an agency dashboard.
   - The dashboard must at minimum allow them to edit their agency profile details and branding.

[X] 6. Team members and leads (after MVP)
   - Allow the agency owner to invite team members (create/link additional WordPress users to the same agency).
   - Expose renter leads/enquiries for that agency in the dashboard, with basic management (view, respond, track).

[✓] 7. Analytics and additional tools (future)
   - Add performance insights (views, clicks, conversions) for the agency’s listings into the dashboard.
   - Gradually roll out additional tools and insights for agencies over time (e.g. reporting, export, integrations).


Data analytics and storage.

Renting behaviour
[✓] Listing views per session.
[] Log search queries & filters.
[] Track contact agent clicks (popup open and/or send).
[] Store listing_id on listinghub_message when contact form has dir_id (unblocks lead reporting).
[] Optional: log save/shortlist events.

Listing performance
[] Views per listing (already done).
[] Add listing_id on messages for view-to-lead and time to first enquiry (same as above store step).
[] Add time-on-listing/agency (JS + endpoint).
[] Add listing completeness score (define fields and formula).

Agency engagement
[] Track agency claimed / unclaimed / claim start (derivable + optional events).
[] Listings per agency (query).
[] Agency logins/sessions (hook wp_login).
[] Define and log response times and agency actions (edit listing, reply to lead, etc.).

Marketplace health
[] Active listings count (weekly/monthly; define “active”).
[] Active renters MAU/WAU (decide logged-in only vs anonymous).
[] Renters & agencies account created (clarify definition).
[] Supply–demand ratio by area (define area and demand).

See TRACKING-FEASIBILITY.md for details and “what we need from you”.


Display & reporting (who sees what).

Admin (WP admin / super admin only)
[] Marketplace health: active listings, MAU/WAU, accounts created, supply–demand by area (e.g. report page or dashboard widget).
[] Search/filter logs: where renters search (queries, filters) – list or export.
[] Agency funnel: claimed vs unclaimed agencies; claim starts / approvals (counts or list).
[] Optional: all listings table with site-wide metrics per row (views, leads) for admins who manage everything.

Agent (agency owner dashboard – e.g. Manage Listings / my-account)
[] Per listing row (Manage Listings table): total views (already shown), leads count (once listing_id on messages exists), optional: contact clicks.
[] Per listing row: optional time-on-listing, time to first enquiry, listing completeness score (when we store them).
[] Agency-level summary for the logged-in agent: total listings, total views across listings, total leads, optional logins/sessions.
[] Do not show other agencies’ data or site-wide marketplace health to agents.

Implementation note: per-row metrics (views, leads, etc.) come from post meta or counted from listinghub_message / events; keep agent views restricted to their own listings (post_author or agency_post_id).

